-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.credit_transactions (
  id text NOT NULL,
  customer_id text,
  amount numeric NOT NULL,
  type text NOT NULL,
  reference text,
  notes text,
  created_by text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT credit_transactions_pkey PRIMARY KEY (id),
  CONSTRAINT credit_transactions_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.customers (
  id text NOT NULL,
  name text NOT NULL,
  phone text NOT NULL,
  email text,
  address text,
  customer_type text DEFAULT 'retail'::text,
  credit_limit numeric DEFAULT 0,
  current_balance numeric DEFAULT 0,
  loyalty_points integer DEFAULT 0,
  CONSTRAINT customers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.inventory_batches (
  id text NOT NULL,
  product_id text,
  batch_number text NOT NULL,
  quantity numeric NOT NULL,
  expiry_date date,
  supplier_id text,
  purchase_date date NOT NULL,
  cost_per_unit numeric NOT NULL,
  CONSTRAINT inventory_batches_pkey PRIMARY KEY (id),
  CONSTRAINT inventory_batches_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id),
  CONSTRAINT inventory_batches_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id)
);
CREATE TABLE public.license_keys (
  id text NOT NULL DEFAULT (gen_random_uuid())::text,
  key text NOT NULL UNIQUE,
  is_used boolean DEFAULT false,
  used_at timestamp with time zone,
  used_by_shop_id text,
  expires_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT license_keys_pkey PRIMARY KEY (id),
  CONSTRAINT license_keys_used_by_shop_id_fkey FOREIGN KEY (used_by_shop_id) REFERENCES public.shops(id)
);
CREATE TABLE public.price_history (
  id text NOT NULL DEFAULT (gen_random_uuid())::text,
  product_id text,
  old_retail_price numeric,
  new_retail_price numeric,
  old_wholesale_price numeric,
  new_wholesale_price numeric,
  old_cost_price numeric,
  new_cost_price numeric,
  changed_by text,
  changed_at timestamp with time zone DEFAULT now(),
  CONSTRAINT price_history_pkey PRIMARY KEY (id),
  CONSTRAINT price_history_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.products (
  id text NOT NULL,
  name text NOT NULL,
  description text,
  category text NOT NULL,
  sku text NOT NULL UNIQUE,
  barcode text,
  unit text NOT NULL,
  retail_price numeric NOT NULL,
  wholesale_price numeric NOT NULL,
  cost_price numeric NOT NULL,
  reorder_level integer DEFAULT 0,
  image_url text,
  active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  is_bulk_item boolean DEFAULT false,
  package_weight numeric,
  price_per_kg numeric,
  cost_per_kg numeric,
  CONSTRAINT products_pkey PRIMARY KEY (id)
);
CREATE TABLE public.scanned_receipts (
  id text NOT NULL,
  supplier_id text,
  receipt_date date NOT NULL,
  image_url text NOT NULL,
  ocr_method text NOT NULL,
  confidence_score numeric DEFAULT 0,
  status text DEFAULT 'pending'::text,
  extracted_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT scanned_receipts_pkey PRIMARY KEY (id),
  CONSTRAINT scanned_receipts_supplier_id_fkey FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id)
);
CREATE TABLE public.shops (
  id text NOT NULL DEFAULT (gen_random_uuid())::text,
  name text NOT NULL,
  logo text,
  address text,
  phone text,
  email text,
  tax_id text,
  currency text DEFAULT 'KES'::text,
  receipt_footer text,
  shop_code text NOT NULL UNIQUE,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT shops_pkey PRIMARY KEY (id)
);
CREATE TABLE public.suppliers (
  id text NOT NULL,
  name text NOT NULL,
  contact_person text NOT NULL,
  phone text NOT NULL,
  email text,
  address text,
  payment_terms text,
  active boolean DEFAULT true,
  CONSTRAINT suppliers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.transaction_items (
  id text NOT NULL,
  transaction_id text,
  product_id text NOT NULL,
  product_name text NOT NULL,
  quantity numeric NOT NULL,
  unit_price numeric NOT NULL,
  discount numeric DEFAULT 0,
  total numeric NOT NULL,
  CONSTRAINT transaction_items_pkey PRIMARY KEY (id),
  CONSTRAINT transaction_items_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.transactions(id)
);
CREATE TABLE public.transactions (
  id text NOT NULL,
  transaction_number text NOT NULL UNIQUE,
  customer_id text,
  customer_name text,
  user_id text NOT NULL,
  transaction_date timestamp with time zone DEFAULT now(),
  subtotal numeric NOT NULL,
  discount numeric DEFAULT 0,
  tax numeric DEFAULT 0,
  total numeric NOT NULL,
  payment_method text NOT NULL,
  payment_status text DEFAULT 'completed'::text,
  reference_number text,
  notes text,
  CONSTRAINT transactions_pkey PRIMARY KEY (id),
  CONSTRAINT transactions_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.customers(id)
);
CREATE TABLE public.users (
  id text NOT NULL DEFAULT (gen_random_uuid())::text,
  auth_id text UNIQUE,
  email text,
  full_name text NOT NULL,
  phone text,
  shop_id text,
  role text NOT NULL DEFAULT 'cashier'::text,
  active boolean DEFAULT true,
  pin text,
  created_at timestamp with time zone DEFAULT now(),
  last_login_at timestamp with time zone,
  CONSTRAINT users_pkey PRIMARY KEY (id),
  CONSTRAINT users_shop_id_fkey FOREIGN KEY (shop_id) REFERENCES public.shops(id)
);